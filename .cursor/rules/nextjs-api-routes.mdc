---
description: Next.js App Router API route conventions
globs: app/api/**/*.ts
alwaysApply: false
---

# Next.js API Route Conventions

## Dynamic rendering

- Set `export const dynamic = 'force-dynamic'` for routes that read from the database or depend on request-time data so they are not statically optimized.

## Dynamic segment params

- For routes like `app/api/.../reports/[id]/route.ts`, receive params from the second argument:

```ts
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const id = params.id
  // ...
}
```

- In Next.js 15+, `params` can be a Promise; if the codebase uses async params, await them before use: `const { id } = await params`.

## Response shape

- Use `NextResponse.json()` for JSON responses; return appropriate status codes (400 for validation, 401 for auth, 404 for missing resource, 500 for server errors).
- For errors, return a body like `{ error: string, details?: string }` so the client can display a message.
